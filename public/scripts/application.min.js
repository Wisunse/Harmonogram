"use strict";angular.module("Harmonogram",["ui.router","ngSanitize","ngMaterial","ngAnimate","ngAria","ngMessages"]).config(["$stateProvider","$locationProvider","$urlRouterProvider","$httpProvider","$mdThemingProvider","$mdDateLocaleProvider",function(e,t,a,n,o,r){n.interceptors.push(["$injector","$q",function(e,t){return{responseError:function(e){return 401===e.status?window.location.href="/login":470===e.status?window.location.href="/":520===e.status&&window.location.reload(),t.reject(e)}}}]),n.defaults.headers.common.Pragma="no-cache",window.history&&window.history.pushState&&t.html5Mode({enabled:!0,requireBase:!1}),e.state("login",{url:"/login",views:{mainView:{templateUrl:"views/public/login",controller:"LoginController"}}}).state("management",{url:"/authenticated",views:{headerView:{templateUrl:"views/protected/menu",controller:"MenuController"},mainView:{templateUrl:"views/protected/management",controller:"ManagementController"}}}).state("users",{url:"/authenticated",views:{headerView:{templateUrl:"views/protected/menu",controller:"MenuController"},mainView:{templateUrl:"views/protected/users",controller:"UsersController"}}}).state("cars",{url:"/authenticated",views:{headerView:{templateUrl:"views/protected/menu",controller:"MenuController"},mainView:{templateUrl:"views/protected/cars",controller:"CarsController"}}}).state("error_404",{url:"/404",views:{errorView:{templateUrl:"views/error_404"}}}),a.otherwise("/404"),o.theme("default").primaryPalette("grey",{default:"900","hue-1":"100","hue-2":"600","hue-3":"A100"}).accentPalette("orange",{default:"500"}).warnPalette("red"),r.months=["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],r.shortMonths=["Sty","Lut","Mar","Kwie","Maj","Cze","Lip","Sie","Wrze","Paź","Lis","Gru"],r.days=["Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota","Niedziela"],r.shortDays=["Pon","Wt","Śr","Czw","P","So","N"]}]).run(["$rootScope","$state","$stateParams","$http","management","cars",function(e,t,a,n,o,r){e.state=t,e.stateParams=a,e.authenticated=null,e.$on("$locationChangeStart",function(t,a,o){var r=a.split("/").slice(-1)[0],i=o.split("/").slice(-1)[0];null===e.authenticated?n.post("/is_authenticated").then(function(t){e.authenticated=t.data.authenticated,e.username=t.data.username}):"login"===r&&"authenticated"===i&&e.authenticated?(t.preventDefault(),alert("Czy na pewno chcesz opuscic aplikacje?")):"authenticated"!==r||"login"!==i||e.authenticated||t.preventDefault()})}]),angular.module("Harmonogram").controller("CarsController",["$scope","$http","$state","$sce","cars",function(e,t,a,n,o){e.cars=o,e.customFullscreen=!0,e.newCar={},o.allCars(),e.addNewCar=function(a){if(a){var n=JSON.stringify({car:e.newCar});t.post("/new_car",n).then(function(e){"1"===e.data?(o.allCars(),o.closeDialog()):e.data})}},e.editCar=function(e){if(e){var a=JSON.stringify({car:o.editCar});t.post("/edit_car",a).then(function(e){"1"===e.data?(o.allCars(),o.closeDialog()):e.data})}}}]),angular.module("Harmonogram").controller("DialogController",["$scope","$http","$state","$sce","management","cars","$timeout","$interval",function(e,t,a,n,o,r,i,l){e.management=o,e.cars=r}]),angular.module("Harmonogram").controller("LoginController",["$scope","$http","$state","$sce",function(e,t,a,n){e.login=function(){if(null!==e.id&&null!==e.password){var n={login:e.id,password:e.password};t.post("/try_login",JSON.stringify(n)).then(function(e){switch(e.data.status){case"1":a.go("management");break;case"-1":alert("puste pole id, albo hasła");break;case"-2":alert("zły login lub hasło");break;case"-3":alert("Nie masz prawa dostępu");break;default:alert("złe logowanie")}})}}}]),angular.module("Harmonogram").controller("MainController",["$scope","$http","$state",function(e,t,a){}]),angular.module("Harmonogram").controller("ManagementController",["$scope","$http","$state","$sce","management","cars","$timeout","$interval","$window",function(e,t,a,n,o,r,i,l,s){e.managementHeight=s.innerHeight-70,e.management=o,e.cars=r,e.managementArray=[],o.monthInfo(),o.dateNow(),o.allRegistry(),r.allCars(),i(function(){o.colorBricks()},1e3),l(function(){r.allCars(),o.allRegistry(),o.colorBricks()},4e3),e.getNumber=function(e){return new Array(e)},e.dayName=function(e){return["ND","PON","WT","ŚR","CZW","PT","SO"][new Date(o.selectedYear+"-"+o.selectedMonth+"-"+e).getDay()]}}]),angular.module("Harmonogram").controller("MenuController",["$scope","$http","$state","$sce","management","$mdSidenav",function(e,t,a,n,o,r){e.management=o,e.goManagement=function(){a.go("management")},e.goUsers=function(){a.go("users")},e.goCars=function(){a.go("cars")},e.goLogOut=function(){t.get("/log_out").then(function(){a.go("login")})},e.openLeftMenu=function(){r("left").toggle()}}]),angular.module("Harmonogram").controller("UsersController",["$scope","$http","$timeout","users",function(e,t,a,n){e.users=n,e.customFullscreen=!0,e.newUser={},e.passwordNotConfirm=!1,n.allUsers(),e.addNewUser=function(a){if(a)if(e.newUser.password===e.newUser.password_confirm){e.passwordNotConfirm=!1;var o=JSON.stringify({user:e.newUser});t.post("/new_user",o).then(function(e){"1"===e.data?(n.allUsers(),n.closeDialog()):e.data})}else e.passwordNotConfirm=!0},e.editUser=function(a){if(a)if(n.editUser.password===n.editUser.password_confirm){e.passwordNotConfirm=!1;var o=JSON.stringify({user:n.editUser});t.post("/edit_user",o).then(function(e){"1"===e.data?(n.allUsers(),n.closeDialog()):e.data})}else e.passwordNotConfirm=!0}}]),angular.module("Harmonogram").directive("scrollStick",function(){return{restrict:"AE",scope:{data:"="},link:function(e,t,a){t[0]}}}),angular.module("Harmonogram").factory("parameters",function(){var e={};return e.showLoginBox=!0,e.showLoginBoxFunction=function(){e.showLoginBox=!0},e}).factory("authentication",["$rootScope","$localStorage","$http","$state","parameters","appAlert","translations",function(e,t,a,n,o,r,i){var l={};return l.username="",l.password="",l.rememberMe=!1,l.useCookie=!0,l.login=function(){o.showLoginBox=!1;var s=JSON.stringify({username:l.username,password:l.password,rememberMe:l.rememberMe,useCookie:l.useCookie});a.post("/login",s).then(function(s){if(s.data.authenticated)e.authenticated=!0,e.username=l.username,l.useCookie||(t.currentUser={token:s.data.token},a.defaults.headers.common.Authorization="Bearer "+s.data.token),n.go("home");else{l.password="";var c=i.setText(1135);c='<div class="text-align-center">'+c+"</div>",r.showAppAlert(c,i.setText(1136),o.showLoginBoxFunction,!1,null)}})},l.logout=function(){l.username="",l.password="",l.rememberMe=!1,a.post("/logout").then(function(o){o.data.logged_out&&(e.authenticated=!1,e.username="",l.useCookie||(delete t.currentUser,a.defaults.headers.common.Authorization=""),n.go("login"))})},l}]),angular.module("Harmonogram").factory("cars",["$rootScope","$http","$state","$mdDialog",function(e,t,a,n){var o={};return o.editCar={},o.cars=null,o.closeDialog=function(){n.hide()},o.allCars=function(){t.get("/all_cars").then(function(e){var t=e.data;o.cars=null,o.cars=t.all_cars})},o.deleteCar=function(e){var a=JSON.stringify({car:e});t.post("/delete_car",a).then(function(){o.allCars()})},o.showAddNewCar=function(e){n.show({controller:"CarsController",templateUrl:"views/dialog/add_new_car",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:!0}).then(function(e){},function(){})},o.showEditCar=function(e,t){o.editCar=e,n.show({controller:"CarsController",templateUrl:"views/dialog/edit_car",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:!0}).then(function(e){},function(){})},o.showDeleteCar=function(e,t){var a=n.confirm().title().textContent("Czy na pewno chcesz usunąć to ten samochód?").ariaLabel("Czy na pewno chcesz usunąć ten samochóð?").targetEvent(t).ok("TAK").cancel("ANULUJ");n.show(a).then(function(){o.deleteCar(e)},function(){})},o}]),angular.module("Harmonogram").factory("management",["$rootScope","$http","$state","$mdDialog","cars","$timeout",function(e,t,a,n,o,r){var i={};return i.buildedMonth=[],i.wholeDate={month:null,year:null},i.registry=null,i.daysInMonth=null,i.managementArray=[{car_id:null,car_name:null,days:[]}],i.translateMonth=["Aktualny","Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"],i.translateYears=[],i.loaded=!1,i.closeDialog=function(){n.hide()},i.allRegistry=function(){t.get("/all_registry").then(function(e){var t=e.data;i.registry=t.all_registry})},i.dateNow=function(){t.get("/dates_now").then(function(e){var t=e.data;i.whole_date=t.whole_date,i.selectedMonth=t.month,i.selectedYear=t.year,i.translateYears=[];for(var a=2017;a<=t.year+1;a++)i.translateYears.push(a)})},i.monthInfo=function(){var e=JSON.stringify({month:i.selectedMonth,year:i.selectedYear});t.post("/month_info",e).then(function(e){var t=e.data;i.wholeDate=t,i.selectedMonth=i.wholeDate.month,i.daysInMonth=t.days_count,i.colorBricks()})},i.buildMonth=function(){o.cars.forEach(function(e){var t={"car.id":e.id,car_name:e.name,month:[]};i.buildedMonth.push(t)})},i.showDayDetails=function(e,t,a){null===t.data_start&&(t.data_end=t.data_start=i.selectedYear+"-"+i.selectedMonth+"-"+t.day_number),i.pickedDay=t,i.pickedDay.car_id=a,n.show({controller:"DialogController",templateUrl:"views/dialog/management_details",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:!0}).then(function(e){},function(){})},i.colorBricks=function(){if(null!==i.wholeDate.year&&null!==o.cars&&null!==i.registry&&null!==i.daysInMonth){var e=i.wholeDate.year,t=i.wholeDate.month,a=[];o.cars.forEach(function(n){for(var o={car_id:n.id,car_name:n.name,days:[]},r=1;r<i.daysInMonth+1;r++){var l=e+"-"+t+"-"+r,s=new Date(l),c=null;i.registry.forEach(function(e){var t=new Date(e.data_start),a=new Date(e.data_end);e.cars_id==n.id&&s>=t&&s<=a&&(c=e)});var u={day_number:r,reg_id:null,data_start:null,data_end:null,info:null,account:null};null!==c&&(u.reg_id=c.id,u.data_start=c.data_start,u.data_end=c.data_end,u.info=c.info,u.account=c.account),o.days.push(u)}a.push(o)}),i.managementArray=a,i.loaded=!0}},i.showDeleteRegister=function(e,t){var a=n.confirm().title().textContent("Czy na pewno chcesz usunąć ten wpis?").ariaLabel("Czy na pewno chcesz usunąć ten wpis?").targetEvent(t).ok("TAK").cancel("ANULUJ");n.show(a).then(function(){i.deleteRegister(e)},function(){})},i.deleteRegister=function(e,a){var n=JSON.stringify({picked_day:e});t.post("/delete_register",n).then(function(){i.allRegistry(),r(function(){i.colorBricks()},1e3)})},i.sendDataToRegister=function(e){if(e){var a=new Date(i.pickedDay.data_end).toLocaleDateString();if(new Date(i.pickedDay.data_start).toLocaleDateString()<=a){var n=JSON.stringify({pickedDay:i.pickedDay});t.post("/new_register",n).then(function(e){t.get("/all_registry").then(function(e){var t=e.data;i.registry=t.all_registry,i.colorBricks(),i.closeDialog()})})}else alert("data rozpoczęcia nie moze byc większa od daty zakończenia")}},i}]),angular.module("Harmonogram").factory("users",["$rootScope","$http","$state","$mdDialog",function(e,t,a,n){var o={};return o.editUser={},o.allUsers=function(){t.get("/all_users").then(function(e){var t=e.data;o.users=t.all_users})},o.deleteUser=function(e){var a=JSON.stringify({user:e});t.post("/delete_user",a).then(function(){o.allUsers()})},o.closeDialog=function(){n.hide()},o.showAddNewUser=function(e){n.show({controller:"UsersController",templateUrl:"views/dialog/add_new_user",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:!0}).then(function(e){},function(){})},o.showEditUser=function(e,t){o.editUser=e,n.show({controller:"UsersController",templateUrl:"views/dialog/edit_user",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:!0}).then(function(e){},function(){})},o.showDeleteUser=function(e,t){var a=n.confirm().title().textContent("Czy na pewno chcesz usunąć to konto?").ariaLabel("Czy na pewno chcesz usunąć to konto?").targetEvent(t).ok("TAK").cancel("ANULUJ");n.show(a).then(function(){o.deleteUser(e)},function(){})},o}]);